name: Delete Releases

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  delete-releases:
    runs-on: ubuntu-latest
    steps:
      - name: Check owner
        run: |
          if [ "${{ github.actor }}" != "${{ github.repository_owner }}" ]; then
            echo "Only owner can run"; exit 1; fi

      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Build
        run: mvn -q -DskipTests install

      - name: Delete all releases and tags
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          OWNER="${{ github.repository_owner }}"
          REPO="${{ github.event.repository.name }}"
          mvn exec:java -Dexec.mainClass=org.standict.codelist.release.ReleaseCleanupMain "-Dexec.args=--owner $OWNER --repo $REPO --github-token $GITHUB_TOKEN"


